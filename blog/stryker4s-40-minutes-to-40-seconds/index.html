<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Stryker4s: from 40 minutes to 40 seconds | Stryker Mutator</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://stryker-mutator.io/images/strykerman.png"><meta data-rh="true" name="twitter:image" content="https://stryker-mutator.io/images/strykerman.png"><meta data-rh="true" property="og:url" content="https://stryker-mutator.io/blog/stryker4s-40-minutes-to-40-seconds/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="mutation testing, JavaScript, TypeScript, C#, .NET, Scala, testing, testing tools, software"><meta data-rh="true" property="og:title" content="Stryker4s: from 40 minutes to 40 seconds | Stryker Mutator"><meta data-rh="true" name="description" content="Stryker4s is your friendly mutation testing framework for Scala. Compared to earlier versions, Stryker4s 0.12 achieves a 60x speed increase in some scenarios ü§Ø. Are you curious to know how? Keep on reading."><meta data-rh="true" property="og:description" content="Stryker4s is your friendly mutation testing framework for Scala. Compared to earlier versions, Stryker4s 0.12 achieves a 60x speed increase in some scenarios ü§Ø. Are you curious to know how? Keep on reading."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-06-16T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/hugo-vrijswijk"><meta data-rh="true" property="article:tag" content="stryker4s"><link data-rh="true" rel="icon" href="/images/stryker.svg"><link data-rh="true" rel="canonical" href="https://stryker-mutator.io/blog/stryker4s-40-minutes-to-40-seconds/"><link data-rh="true" rel="alternate" href="https://stryker-mutator.io/blog/stryker4s-40-minutes-to-40-seconds/" hreflang="en"><link data-rh="true" rel="alternate" href="https://stryker-mutator.io/blog/stryker4s-40-minutes-to-40-seconds/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QF3A1J09N2-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Stryker Mutator RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Stryker Mutator Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JN49KF9BV1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JN49KF9BV1",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Stryker Mutator" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e20e7114.css">
<link rel="preload" href="/assets/js/runtime~main.d91ce9d3.js" as="script">
<link rel="preload" href="/assets/js/main.b7804fe7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-navbar-background-color, #fff);color:var(--ifm-navbar-link-color, #000)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">üìΩÔ∏è <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=sGwfwtkaDfk">Watch the video "How to test your tests in .NET" from <i>Nick Chapsas</i></a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/stryker.svg" alt="Stryker Mutator Logo" class="themedImage_ToTc themedImage--light_HNdA" height="32" width="32"><img src="/images/stryker.svg" alt="Stryker Mutator Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="32" width="32"></div><b class="navbar__title text--truncate">Stryker Mutator</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/docs/stryker-js/introduction/">For JavaScript</a><a class="navbar__item navbar__link" href="/docs/stryker-net/introduction/">For C#</a><a class="navbar__item navbar__link" href="/docs/stryker4s/getting-started/">For Scala</a><a class="navbar__item navbar__link" href="/docs/General/example/">An example</a></div><div class="navbar__items navbar__items--right"><a href="https://dashboard.stryker-mutator.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link header-github-link" target="_self" aria-label="GitHub repository dropdown"></a><ul class="dropdown__menu"><li><a href="https://github.com/stryker-mutator/stryker-js" target="_blank" rel="noopener noreferrer" class="dropdown__link">StrykerJS (JS &amp; TS)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/stryker-mutator/stryker-net" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stryker.NET (C#)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/stryker-mutator/stryker4s" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stryker4s (Scala)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/stryker-mutator/mutation-testing-elements" target="_blank" rel="noopener noreferrer" class="dropdown__link">Mutation Testing Elements<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/stryker-mutator/stryker-mutator.github.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">This website<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/announcing-incremental-mode/">Announcing StrykerJS incremental mode</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/connect-pit-to-stryker-dashboard/">Connect PIT to Stryker Dashboard</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/stryker-js-v6-expeditious-superior-mutations/">StrykerJS v6.0: Expeditious Superior Mutations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/announcing-stryker-js-v6.0-beta/">Announcing StrykerJS v6.0 Beta</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021-30-10-announcing-stryker-net-1.md/">Announcing Stryker.NET 1.0</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Stryker4s: from 40 minutes to 40 seconds</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-06-16T00:00:00.000Z" itemprop="datePublished">June 16, 2021</time> ¬∑ <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/hugo-vrijswijk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/10114577" alt="Hugo van Rijswijk"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/hugo-vrijswijk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Hugo van Rijswijk</span></a></div><small class="avatar__subtitle" itemprop="description">Stryker4s Team</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>Stryker4s is your friendly mutation testing framework for Scala. Compared to earlier versions, Stryker4s <code>0.12</code> achieves a 60x speed increase in some scenarios ü§Ø. Are you curious to know how? Keep on reading.</p><p>If you&#x27;re new to mutation testing, it&#x27;s a way to measure your tests&#x27; effectiveness. A mutation testing framework will make small changes, called <em>mutants</em>, one by one in your source code. Then it will run your tests to see if one of them fails. If so, you just &quot;killed&quot; that mutant; if not, it &quot;survived&quot;. If too many mutants survive, you probably want to improve your tests. The mutation testing report will give you insides into the test cases you may have missed. If this all sounds complicated, please take a look at the recent talk <a href="https://www.youtube.com/watch?v=Vq9eqZzblfg" target="_blank" rel="noopener noreferrer">&quot;Who is testing your tests?&quot;</a> from <em>Scala Love in the City</em> or check out the rest of the <a href="/">website</a>.</p><p>In this blog we&#x27;ll talk about the performance improvements made in the last couple Stryker4s versions and dive into how they are made possible.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-in-short">üìÉ In short<a class="hash-link" href="#-in-short" title="Direct link to heading">‚Äã</a></h2><p>Imagine you&#x27;re on your way to a sunny holiday destination. You&#x27;ve checked in your luggage, gone through customs, and boarded the plane. Then, the plane moves forward a couple of meters, and you&#x27;re thrown out and sent back to customs before going through the whole thing again. It&#x27;ll take years before you get to sip on your umbrella cocktail üçπ! This is exactly how Stryker4s has been running your code‚Ä¶ until now.</p><p>A lot has changed in recent versions of Stryker4s. Stryker4s now runs your tests in an entirely different way, bringing big performance improvements. As an example, running Stryker4s on the Stryker4s codebase used to take about 40 minutes on <code>0.9.1</code>. On<code>0.12.1</code>, this has been reduced to a fast 40 seconds. A short list of some new features:</p><ul><li>‚ú® New testrunner boasting improved performance</li><li>üîÄ Concurrency to improve speed by using all available cores</li><li>üïµÔ∏è‚Äç‚ôÄÔ∏è Coverage analysis to skip mutants without coverage</li><li>‚è±Ô∏è Timeout detection in tests</li><li>üëΩ New mutator: regular expressions. Thanks to <a href="https://github.com/stryker-mutator/weapon-regex/" target="_blank" rel="noopener noreferrer">Weapon regeX</a>!</li></ul><p>In the rest of this blog post, we&#x27;ll do a deep-dive into the increased performance. Let&#x27;s start by taking a look at the older version of Stryker4s.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-the-old">üê¢ The old<a class="hash-link" href="#-the-old" title="Direct link to heading">‚Äã</a></h2><p>In the older sbt plugin, there was a lot of overhead in running your tests. As a quick reminder, Stryker4s uses <a href="https://stryker-mutator.io/blog/mutation-switching/" target="_blank" rel="noopener noreferrer">mutation switching</a>, so it only has to compile your code once, instead of for each mutant. After mutating your source code, Stryker4s would essentially just call <code>sbt test</code> with the mutated code for every mutant. This means sbt would:</p><ol><li>Look for code changes (which there never are).</li><li>Make sure all compiled code is up-to-date (which it always is).</li><li>Start a new Java process with your class files, dependencies, and a small sbt entry point library.</li><li>Run your tests and report the results back to the main sbt process.</li><li>Repeat for the next mutant.</li></ol><div id="mermaid-sbt-old"></div><div class="mermaid-diagram"></div><p>Doing those checks and starting a new process makes a lot of sense for a development workflow, but not for mutation testing. This implementation of the test runner hasn&#x27;t changed much in the two years that the plugin has existed. Time for some improvements!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-the-new">üêá The new<a class="hash-link" href="#-the-new" title="Direct link to heading">‚Äã</a></h2><p>It&#x27;s clear the process can be optimized. Once Stryker4s is set up and all mutations have been compiled, the only thing we really want to do is run some tests and get a result. Sbt doesn&#x27;t give plugins full control over the entire test process, but it does have all the information about <em>what</em> your project looks like. This is something we can work with!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-meet-build-info">üèóÔ∏è Meet: build info<a class="hash-link" href="#Ô∏è-meet-build-info" title="Direct link to heading">‚Äã</a></h3><p>The first thing Stryker4s needs to do is figure out what tests our project contains. One of the great things about sbt is its standardization and extensibility as a build tool. Because sbt knows exactly what your project looks like, plugins can retrieve all this information. To find out what tests you have, Stryker4s uses three pieces of information from sbt:</p><ol><li><code>fullClasspath</code> location of all dependency JARs (including test-dependencies) and <code>.class</code> files of your compiled code.</li><li><code>loadedTestFrameworks</code> the configured test framework. Sbt detects a couple of frameworks by default, but if you use MUnit you might remember having to add <code>testFrameworks += new TestFramework(&quot;munit.Framework&quot;)</code> to your build.sbt before MUnit can run.</li><li><code>testGrouping</code> contains every test suite sbt discovers in your project.</li></ol><p>You can try running these yourself in a sbt console to see how Stryker4s looks at your project:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sbt:stryker4s-core&gt; show fullClasspath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[info] * Attributed(~/stryker4s/core/target/jvm-2.13/classes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[info] * Attributed(~/.cache/coursier/v1/https/repo1.maven.org/maven2/org/scala-lang/scala-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library/2.13.4/scala-library-2.13.4.jar)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[info] * Attributed(~/.cache/coursier/v1/https/repo1.maven.org/maven2/com/github/pathikrit/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">better-files_2.13/3.9.1/better-files_2.13-3.9.1.jar)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sbt:stryker4s-core&gt; show loadedTestFrameworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[info] Map(TestFramework(org.scalatest.tools.Framework, org.scalatest.tools.ScalaTestFramework) -&gt; org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.scalatest.tools.Framework@2b9d52d5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sbt:stryker4s-core&gt; show testGrouping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[info] * (&lt;default&gt;,Vector(Test stryker4s.config.TestFilterTest : subclass(false, org.scalatest.Suite)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">, Test stryker4s.extension.FileExtensionsTest : subclass(false, org.scalatest.Suite), Test stryker4s.m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utants.MutatorTest : subclass(false, org.scalatest.Suite), Test stryker4s.mutants.AddAllMutationsTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: subclass(false, org.scalatest.Suite), ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We now know what tests are in your project. Let&#x27;s have a look at running those tests:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-meet-test-interfaces">üß™ Meet: test interfaces<a class="hash-link" href="#-meet-test-interfaces" title="Direct link to heading">‚Äã</a></h3><p>This is something our friends in the NodeJS world are (rightfully) a little <a href="https://stryker-mutator.io/docs/stryker-js/plugins#test-runners" target="_blank" rel="noopener noreferrer">jealous of</a> üòè. When you call <code>sbt test</code>, sbt will look for any registered test frameworks that implement the <a href="https://github.com/sbt/test-interface" target="_blank" rel="noopener noreferrer">test-interface</a> (from <code>loadedTestFrameworks</code>). This is a small collection of interfaces that let a test framework tell sbt how to run tests in that framework. Because all test frameworks in sbt implement this interface, we have a single programmatic way to call any test framework. It doesn&#x27;t matter if you&#x27;re using ScalaTest, MUnit, Weaver-test or anything else. Using a bit of reflection, we can create an instance of the test framework runner and run tests:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> framework </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> classLoader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loadClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">testFrameworkClass</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getConstructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">newInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">asInstanceOf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Framework</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> runner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> framework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">runner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> remoteArgs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> classLoader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> testTasks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Array</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Task</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> runner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">testGrouping</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">taskDefs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testTasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">foreach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">testTask </span><span class="token keyword" style="color:#00009f">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  testTask</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Stryker4s can then use this to activate a mutant and instantly run the tests without any overhead from sbt.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-meet-concurrency">üîÄ Meet: concurrency<a class="hash-link" href="#-meet-concurrency" title="Direct link to heading">‚Äã</a></h3><p>Stryker4s activates and runs each mutant one by one in isolation. This is to make sure one mutant won&#x27;t have an impact on the result of another. This is done by creating a separate process for it. However, there&#x27;s no rule that says we can&#x27;t start multiple Java processes at the same time and run those in parallel.</p><p>With multiple separate worker-processes, each worker has its own separate memory, threads, and active mutant. This way, if one mutant results in an <code>OutOfMemoryError</code> it won&#x27;t impact the others. In long-lived processes like mutation testing, the performance increases of parallelism far outweigh the overhead of starting and managing multiple workers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-putting-it-all-together">üß∞ Putting it all together<a class="hash-link" href="#-putting-it-all-together" title="Direct link to heading">‚Äã</a></h3><p>Stryker4s can start a new process with all the information collected above. Because Stryker4s now fully controls how it runs your tests, it can eliminate any overhead of starting new processes or looking for source code changes. It looks a little something like this:</p><ol><li>Start new worker processes in parallel with the full test classpath and send them all the needed test setup.</li><li>Create a new instance of the test framework in the created process.</li><li>For each mutant, programmatically run the tests on the worker process.</li></ol><div id="mermaid-sbt-new"></div><div class="mermaid-diagram"></div><p>As you can see, there&#x27;s not much overhead left in running your tests. The limiting factor is now how fast your tests are! When running Stryker4s on itself, this method improves performance 60x: from 40 minutes to 40 seconds.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-whats-next">üîÆ What&#x27;s next?<a class="hash-link" href="#-whats-next" title="Direct link to heading">‚Äã</a></h2><p>In this post, we&#x27;ve shown you how Stryker4s uses sbt&#x27;s test information to reduce overhead and provide massive performance increases. We&#x27;re very excited for you to try out the increased performance! If you have any feedback or questions, find us on <a href="https://github.com/stryker-mutator/stryker4s" target="_blank" rel="noopener noreferrer">GitHub</a> or <a href="https://join.slack.com/t/stryker-mutator/shared_invite/enQtOTUyMTYyNTg1NDQ0LTU4ODNmZDlmN2I3MmEyMTVhYjZlYmJkOThlNTY3NTM1M2QxYmM5YTM3ODQxYmJjY2YyYzllM2RkMmM1NjNjZjM" target="_blank" rel="noopener noreferrer">Slack</a>.</p><p>Next, we want to also bring these performance improvements to the Maven plugin, add per-test coverage support, improve the HTML report to show your tests and perhaps even support some <a href="https://github.com/stryker-mutator/stryker4k" target="_blank" rel="noopener noreferrer">new languages</a>?</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/stryker-4-s/">stryker4s</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/stryker-mutator/stryker-mutator.github.io/edit/develop/blog/2021-06-16-stryker4s-sbt-performance.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2021-30-10-announcing-stryker-net-1.md/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Announcing Stryker.NET 1.0</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/announcing-stryker-js-5-brave-new-dimension.md/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Announcing StrykerJS 5.0 - Brave new Dimension</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#-in-short" class="table-of-contents__link toc-highlight">üìÉ In short</a></li><li><a href="#-the-old" class="table-of-contents__link toc-highlight">üê¢ The old</a></li><li><a href="#-the-new" class="table-of-contents__link toc-highlight">üêá The new</a><ul><li><a href="#Ô∏è-meet-build-info" class="table-of-contents__link toc-highlight">üèóÔ∏è Meet: build info</a></li><li><a href="#-meet-test-interfaces" class="table-of-contents__link toc-highlight">üß™ Meet: test interfaces</a></li><li><a href="#-meet-concurrency" class="table-of-contents__link toc-highlight">üîÄ Meet: concurrency</a></li><li><a href="#-putting-it-all-together" class="table-of-contents__link toc-highlight">üß∞ Putting it all together</a></li></ul></li><li><a href="#-whats-next" class="table-of-contents__link toc-highlight">üîÆ What&#39;s next?</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/General/faq/">FAQ</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/stryker-mutator/shared_invite/enQtOTUyMTYyNTg1NDQ0LTU4ODNmZDlmN2I3MmEyMTVhYjZlYmJkOThlNTY3NTM1M2QxYmM5YTM3ODQxYmJjY2YyYzllM2RkMmM1NjNjZjM" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/stryker_mutator" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/stryker-mutator/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://infosupport.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/images/info-support.svg" alt="Info Support Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/images/info-support.svg" alt="Info Support Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Powered by <a target="_blank" rel="noopener noreferrer" href="https://www.infosupport.com/open-source/">Info Support</a>.<br>Stryker is released under the Apache 2.0 license. Site by the <a target="_blank" rel="noopener noreferrer" href="https://github.com/orgs/stryker-mutator/people">Stryker team</a>. Logo by Selina van den Top.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d91ce9d3.js"></script>
<script src="/assets/js/main.b7804fe7.js"></script>
</body>
</html>